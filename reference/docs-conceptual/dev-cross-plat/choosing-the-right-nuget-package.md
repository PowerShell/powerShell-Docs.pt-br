---
title: Como escolher o pacote NuGet do PowerShell correto para seu projeto .NET
description: Com os pacotes executáveis publicados com cada versão do PowerShell, a equipe do PowerShell também mantém diversos pacotes disponíveis no NuGet. Com esses pacotes, é possível ter o PowerShell como destino como se fosse uma plataforma de API no .NET.
ms.date: 06/25/2020
ms.custom: rjmholt
ms.openlocfilehash: 39369ed872faa76ad2c41d813da5e0a98cf1c078
ms.sourcegitcommit: d0461273abb6db099c5e784ef00f57fd551be4a6
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85795242"
---
# <a name="choosing-the-right-powershell-nuget-package-for-your-net-project"></a><span data-ttu-id="a76e9-104">Como escolher o pacote NuGet do PowerShell correto para seu projeto .NET</span><span class="sxs-lookup"><span data-stu-id="a76e9-104">Choosing the right PowerShell NuGet package for your .NET project</span></span>

<span data-ttu-id="a76e9-105">Com os pacotes executáveis `pwsh` publicados com cada versão do PowerShell, a equipe do PowerShell também mantém diversos pacotes disponíveis no [NuGet][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-105">Alongside the `pwsh` executable packages published with each PowerShell release, the PowerShell team also maintains several packages available on [NuGet][].</span></span> <span data-ttu-id="a76e9-106">Com esses pacotes, é possível ter o PowerShell como destino como se fosse uma plataforma de API no .NET.</span><span class="sxs-lookup"><span data-stu-id="a76e9-106">These packages allow targeting PowerShell as an API platform in .NET.</span></span>

<span data-ttu-id="a76e9-107">Como um aplicativo .NET que fornece APIs e espera carregar bibliotecas .NET que implementam suas próprias (módulos binários), é essencial que o PowerShell esteja disponível na forma de um pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="a76e9-107">As a .NET application that provides APIs and expects to load .NET libraries implementing its own (binary modules), it's essential that PowerShell be available in the form of a NuGet package.</span></span>

<span data-ttu-id="a76e9-108">Atualmente, diversos pacotes NuGet fornecem alguma representação da área de superfície da API do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-108">Currently there are several NuGet packages that provide some representation of the PowerShell API surface area.</span></span> <span data-ttu-id="a76e9-109">Nem sempre fica claro qual pacote usar com um projeto específico.</span><span class="sxs-lookup"><span data-stu-id="a76e9-109">Which package to use with a particular project hasn't always been made clear.</span></span> <span data-ttu-id="a76e9-110">Este artigo esclarece alguns cenários comuns de projetos .NET direcionados ao PowerShell e como escolher o pacote NuGet correto que será o destino de seu projeto .NET orientado ao PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-110">This article sheds some light on a few common scenarios for PowerShell-targeting .NET projects and how to choose the right NuGet package to target for your PowerShell-oriented .NET project.</span></span>

## <a name="hosting-vs-referencing"></a><span data-ttu-id="a76e9-111">Hospedagem versus referência</span><span class="sxs-lookup"><span data-stu-id="a76e9-111">Hosting vs referencing</span></span>

<span data-ttu-id="a76e9-112">Alguns projetos .NET buscam escrever código para ser carregado em um runtime do PowerShell preexistente (como `pwsh`, `powershell.exe`, o Console integrado do PowerShell ou o ISE), enquanto outros querem executar o PowerShell nos próprios aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a76e9-112">Some .NET projects seek to write code to be loaded into a pre-existing PowerShell runtime (such as `pwsh`, `powershell.exe`, the PowerShell Integrated Console or the ISE), while others want to run PowerShell in their own applications.</span></span>

- <span data-ttu-id="a76e9-113">A **referência** é usada quando um projeto, geralmente um módulo, tem a finalidade de ser carregado no PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-113">**Referencing** is for when a project, usually a module, is intended to be loaded into PowerShell.</span></span>
  <span data-ttu-id="a76e9-114">Ele deve ser compilado em relação às APIs que o PowerShell fornece para interagir com ele, mas a implementação do PowerShell é fornecida pelo carregamento no processo do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-114">It must be compiled against the APIs that PowerShell provides in order to interact with it, but the PowerShell implementation is supplied by the PowerShell process loading it in.</span></span> <span data-ttu-id="a76e9-115">Para fazer referência, um projeto pode usar [assemblies de referência][] ou os assemblies de runtime reais como destino de compilação, mas deve garantir que nenhum deles seja pulicado com seu build.</span><span class="sxs-lookup"><span data-stu-id="a76e9-115">For referencing, a project can use [reference assemblies][] or the actual runtime assemblies as a compilation target, but must ensure that it does not publish any of these with its build.</span></span>
- <span data-ttu-id="a76e9-116">A **hospedagem** ocorre quando um projeto precisa da própria implementação do PowerShell, geralmente por ser um aplicativo autônomo que precisa executar o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-116">**Hosting** is when a project needs its own implementation of PowerShell, usually because it is a standalone application that needs to run PowerShell.</span></span> <span data-ttu-id="a76e9-117">Nesse caso, assemblies de referência pura não podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="a76e9-117">In this case, pure reference assemblies cannot be used.</span></span> <span data-ttu-id="a76e9-118">Em vez disso, é necessário depender de uma implementação concreta do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-118">Instead, a concrete PowerShell implementation must be depended upon.</span></span> <span data-ttu-id="a76e9-119">Como uma implementação concreta do PowerShell deve ser usada, uma versão específica dele deve ser escolhida para hospedagem; um aplicativo host não pode ter como destino várias versões do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-119">Because a concrete PowerShell implementation must be used, a specific version of PowerShell must be chosen for hosting; a single host application cannot multi-target PowerShell versions.</span></span>

### <a name="publishing-projects-that-target-powershell-as-a-reference"></a><span data-ttu-id="a76e9-120">Publicando projetos em que o PowerShell é um destino de referência</span><span class="sxs-lookup"><span data-stu-id="a76e9-120">Publishing projects that target PowerShell as a reference</span></span>

> [!NOTE]
> <span data-ttu-id="a76e9-121">Quando usamos o termo **publicar** neste artigo, nos referimos a executar `dotnet publish`, o que coloca uma biblioteca do .NET em um diretório com todas as suas dependências, pronta para implantação em um runtime específico.</span><span class="sxs-lookup"><span data-stu-id="a76e9-121">We use the term **publish** in this article to refer to running `dotnet publish`, which places a .NET library into a directory with all of its dependencies, ready for deployment to a particular runtime.</span></span>

<span data-ttu-id="a76e9-122">Para evitar a publicação de dependências do projeto que estão sendo usadas apenas como destinos de referência de compilação, é recomendável definir o [atributo PrivateAssets][]:</span><span class="sxs-lookup"><span data-stu-id="a76e9-122">In order to prevent publishing project dependencies that are just being used as compilation reference targets, it is recommended to set the [PrivateAssets attribute][]:</span></span>

```xml
<PackageReference Include="PowerShellStandard.Library" Version="5.1.0.0" PrivateAssets="all" />
```

<span data-ttu-id="a76e9-123">Caso se esqueça de fazer isso e use um assembly de referência como destino, você poderá ter problemas relacionados ao uso da implementação padrão do assembly de referência em vez da implementação real.</span><span class="sxs-lookup"><span data-stu-id="a76e9-123">If you forget to do this and use a reference assembly as your target, you may see issues related to using the reference assembly's default implementation instead of the actual implementation.</span></span> <span data-ttu-id="a76e9-124">Isso pode assumir a forma de uma `NullReferenceException`, uma vez que os assemblies de referência costumam simular a API de implementação, retornando apenas `null`.</span><span class="sxs-lookup"><span data-stu-id="a76e9-124">This may take the form of a `NullReferenceException`, since reference assemblies often mock the implementation API by simply returning `null`.</span></span>

## <a name="key-kinds-of-powershell-targeting-net-projects"></a><span data-ttu-id="a76e9-125">Principais tipos de projetos .NET que têm o PowerShell como destino</span><span class="sxs-lookup"><span data-stu-id="a76e9-125">Key kinds of PowerShell-targeting .NET projects</span></span>

<span data-ttu-id="a76e9-126">Embora qualquer aplicativo ou biblioteca do .NET possa inserir o PowerShell, há alguns cenários comuns que usam APIs do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="a76e9-126">While any .NET library or application can embed PowerShell, there are some common scenarios that use PowerShell APIs:</span></span>

- <span data-ttu-id="a76e9-127">**Implementar um módulo binário do PowerShell**</span><span class="sxs-lookup"><span data-stu-id="a76e9-127">**Implementing a PowerShell binary module**</span></span>

  <span data-ttu-id="a76e9-128">Módulos binários do PowerShell são bibliotecas do .NET carregadas pelo PowerShell que precisam implementar APIs do PowerShell, como os tipos [PSCmdlet][] ou [CmdletProvider][], para expor cmdlets ou provedores, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a76e9-128">PowerShell binary modules are .NET libraries loaded by PowerShell that must implement PowerShell APIs like the [PSCmdlet][] or [CmdletProvider][] types in order to expose cmdlets or providers respectively.</span></span> <span data-ttu-id="a76e9-129">Como são carregados, os módulos buscam compilar em relação a referências ao PowerShell sem publicá-lo em seu build.</span><span class="sxs-lookup"><span data-stu-id="a76e9-129">Because they are loaded in, modules seek to compile against references to PowerShell without publishing it in their build.</span></span> <span data-ttu-id="a76e9-130">Também é comum que os módulos queiram dar suporte a várias versões e plataformas do PowerShell, idealmente com um mínimo de sobrecarga de espaço em disco, complexidade ou implementação repetida.</span><span class="sxs-lookup"><span data-stu-id="a76e9-130">It's also common for modules to want to support multiple PowerShell versions and platforms, ideally with a minimum of overhead of disk space, complexity, or repeated implementation.</span></span> <span data-ttu-id="a76e9-131">Confira [about_Modules][] para obter mais informações sobre módulos.</span><span class="sxs-lookup"><span data-stu-id="a76e9-131">See [about_Modules][] for more information about modules.</span></span>

- <span data-ttu-id="a76e9-132">**Implementar um Host do PowerShell**</span><span class="sxs-lookup"><span data-stu-id="a76e9-132">**Implementing a PowerShell Host**</span></span>

  <span data-ttu-id="a76e9-133">Um Host do PowerShell fornece uma camada de interação para o runtime do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-133">A PowerShell Host provides an interaction layer for the PowerShell runtime.</span></span> <span data-ttu-id="a76e9-134">Trata-se de uma forma específica de _hospedagem_, em que um [PSHost][] é implementado como uma nova interface do usuário no PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-134">It is a specific form of _hosting_, where a [PSHost][] is implemented as a new user interface to PowerShell.</span></span> <span data-ttu-id="a76e9-135">Por exemplo, o ConsoleHost do PowerShell fornece uma interface do usuário de terminal para executáveis do PowerShell, enquanto o Host dos Serviços do Editor do PowerShell e o Host do ISE fornecem uma interface parcialmente gráfica do usuário integrada ao editor em torno do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-135">For example, the PowerShell ConsoleHost provides a terminal user interface for PowerShell executables, while the PowerShell Editor Services Host and the ISE Host both provide an editor-integrated partially graphical user interface around PowerShell.</span></span> <span data-ttu-id="a76e9-136">Embora seja possível carregar um host em um processo existente do PowerShell, é muito mais comum que uma implementação de host atue como uma implementação autônoma do PowerShell que redistribui o mecanismo do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-136">While it's possible to load a host onto an existing PowerShell process, it's much more common for a host implementation to act as a standalone PowerShell implementation that redistributes the PowerShell engine.</span></span>

- <span data-ttu-id="a76e9-137">**Chamar o PowerShell de outro aplicativo .NET**</span><span class="sxs-lookup"><span data-stu-id="a76e9-137">**Calling into PowerShell from another .NET application**</span></span>

  <span data-ttu-id="a76e9-138">Assim como ocorre com qualquer aplicativo, o PowerShell pode ser chamado como um subprocesso para executar cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="a76e9-138">As with any application, PowerShell can be called as a subprocess to run workloads.</span></span> <span data-ttu-id="a76e9-139">No entanto, como um aplicativo .NET, também é possível invocar o PowerShell em processo para recuperar objetos .NET completos para uso no aplicativo autor da chamada.</span><span class="sxs-lookup"><span data-stu-id="a76e9-139">However, as a .NET application, it's also possible to invoke PowerShell in-process to get back full .NET objects for use within the calling application.</span></span> <span data-ttu-id="a76e9-140">Essa é uma forma mais geral _hospedagem_, em que o aplicativo mantém a própria implementação do PowerShell para uso interno.</span><span class="sxs-lookup"><span data-stu-id="a76e9-140">This is a more general form of _hosting_, where the application holds its own PowerShell implementation for internal use.</span></span> <span data-ttu-id="a76e9-141">Exemplos podem ser um serviço ou daemon que executa o PowerShell para gerenciar o estado do computador ou um aplicativo Web que executa o PowerShell quando solicitado para fazer algo como gerenciar implantações de nuvem.</span><span class="sxs-lookup"><span data-stu-id="a76e9-141">Examples of this might be a service or daemon running PowerShell to manage machine state or a web application that runs PowerShell on request to do something like manage cloud deployments.</span></span>

- <span data-ttu-id="a76e9-142">**Efetuar o teste de unidade de módulos do PowerShell usando o .NET**</span><span class="sxs-lookup"><span data-stu-id="a76e9-142">**Unit testing PowerShell modules from .NET**</span></span>

  <span data-ttu-id="a76e9-143">Embora módulos e outras bibliotecas criadas para expor funcionalidades ao PowerShell devam ser testados principalmente no PowerShell (recomendamos o [Pester][]), às vezes é necessário efetuar o teste de unidade de APIs escritas para um módulo do PowerShell no .NET.</span><span class="sxs-lookup"><span data-stu-id="a76e9-143">While modules and other libraries designed to expose functionality to PowerShell should be primarily tested from PowerShell (we recommend [Pester][]), sometimes it's necessary to unit test APIs written for a PowerShell module from .NET.</span></span> <span data-ttu-id="a76e9-144">Essa situação ocorre quando o código do módulo tenta ter várias versões do PowerShell como destino, enquanto os testes devem executá-lo em implementações concretas específicas.</span><span class="sxs-lookup"><span data-stu-id="a76e9-144">This situation involves the module code trying to target a number of PowerShell versions, while testing should run it on specific, concrete implementations.</span></span>

## <a name="powershell-nuget-packages-at-a-glance"></a><span data-ttu-id="a76e9-145">Pacotes NuGet do PowerShell em um relance</span><span class="sxs-lookup"><span data-stu-id="a76e9-145">PowerShell NuGet packages at a glance</span></span>

<span data-ttu-id="a76e9-146">Neste artigo, abordaremos os seguintes pacotes NuGet que expõem APIs do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="a76e9-146">In this article, we'll cover the following NuGet packages that expose PowerShell APIs:</span></span>

- <span data-ttu-id="a76e9-147">[PowerShellStandard.Library][], um assembly de referência que habilita a criação de um só assembly que pode ser carregado por vários runtimes do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-147">[PowerShellStandard.Library][], a reference assembly that enables building a single assembly that can be loaded by multiple PowerShell runtimes.</span></span>
- <span data-ttu-id="a76e9-148">[Microsoft.PowerShell.SDK][], a maneira de direcionar e hospedar novamente o SDK do PowerShell completo</span><span class="sxs-lookup"><span data-stu-id="a76e9-148">[Microsoft.PowerShell.SDK][], the way to target and rehost the whole PowerShell SDK</span></span>
- <span data-ttu-id="a76e9-149">O pacote [System.Management.Automation][], a implementação de mecanismo e runtime principal do PowerShell, que pode ser útil em implementações hospedadas mínimas e em cenários em que o destino é uma versão específica.</span><span class="sxs-lookup"><span data-stu-id="a76e9-149">The [System.Management.Automation][] package, the core PowerShell runtime and engine implementation, that can be useful in minimal hosted implementations and for version-specific targeting scenarios.</span></span>
- <span data-ttu-id="a76e9-150">Os **assemblies de referência do Windows PowerShell**, a maneira de direcionar e hospedar novamente, de maneira efetiva, o Windows PowerShell (versões 5.1 e anteriores do PowerShell).</span><span class="sxs-lookup"><span data-stu-id="a76e9-150">The **Windows PowerShell reference assemblies**, the way to target and effectively rehost Windows PowerShell (PowerShell versions 5.1 and below).</span></span>

> [!NOTE]
> <span data-ttu-id="a76e9-151">O pacote [NuGet do PowerShell][] não é um pacote de biblioteca do .NET, ele fornece a implementação da ferramenta dotnet global do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-151">The [PowerShell NuGet][] package is not a .NET library package at all, but instead provides the PowerShell dotnet global tool implementation.</span></span> <span data-ttu-id="a76e9-152">Ela não deve ser usada por nenhum projeto, pois fornece apenas um executável.</span><span class="sxs-lookup"><span data-stu-id="a76e9-152">This should not be used by any projects, since it only provides an executable.</span></span>

## <a name="powershellstandardlibrary"></a><span data-ttu-id="a76e9-153">PowerShellStandard.Library</span><span class="sxs-lookup"><span data-stu-id="a76e9-153">PowerShellStandard.Library</span></span>

<span data-ttu-id="a76e9-154">A Biblioteca PowerShell Standard é um assembly de referência que captura a interseção das APIs das versões 7, 6 e 5.1 do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-154">The PowerShell Standard library is a reference assembly that captures the intersection of the APIs of PowerShell versions 7, 6 and 5.1.</span></span> <span data-ttu-id="a76e9-155">Isso proporciona uma superfície de API verificada em tempo de compilação com a qual compilar código .NET, permitindo que projetos .NET sejam direcionados às versões 7, 6 e 5.1 do PowerShell sem correr risco de chamar uma API que não estará lá.</span><span class="sxs-lookup"><span data-stu-id="a76e9-155">This provides a compile-time-checked API surface to compile .NET code against, allowing .NET projects to target PowerShell versions 7, 6 and 5.1 without risking calling an API that won't be there.</span></span>

<span data-ttu-id="a76e9-156">O PowerShell Standard tem a finalidade de escrever módulos do PowerShell ou outros códigos que devem ser executados somente depois de serem carregados em um processo do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-156">PowerShell Standard is intended for writing PowerShell modules, or other code only intended to be run after loading it into a PowerShell process.</span></span> <span data-ttu-id="a76e9-157">Por ser um assembly de referência, o PowerShell Standard não contém nenhuma implementação e, portanto, não fornece nenhuma funcionalidade para aplicativos autônomos.</span><span class="sxs-lookup"><span data-stu-id="a76e9-157">Because it is a reference assembly, PowerShell Standard contains no implementation itself, so provides no functionality for standalone applications.</span></span>

### <a name="using-powershell-standard-with-different-net-runtimes"></a><span data-ttu-id="a76e9-158">Usando o PowerShell Standard com diferentes runtimes .NET</span><span class="sxs-lookup"><span data-stu-id="a76e9-158">Using PowerShell Standard with different .NET runtimes</span></span>

<span data-ttu-id="a76e9-159">O PowerShell Standard é direcionado ao runtime de destino [.NET Standard 2.0][], que é um runtime de fachada projetado para fornecer uma área de superfície comum compartilhada pelo .NET Framework e pelo .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a76e9-159">PowerShell Standard targets the [.NET Standard 2.0][] target runtime, which is a façade runtime designed to provide a common surface area shared by .NET Framework and .NET Core.</span></span> <span data-ttu-id="a76e9-160">Com isso, é possível ter com destino um só runtime para produzir um só assembly que funcionará com várias versões do PowerShell, mas as seguintes consequências se aplicam:</span><span class="sxs-lookup"><span data-stu-id="a76e9-160">This allows targeting a single runtime to produce a single assembly that will work with multiple PowerShell versions, but has the following consequences:</span></span>

- <span data-ttu-id="a76e9-161">O PowerShell que carregará o módulo ou a biblioteca precisa executar, no mínimo, o .NET 4.6.1, uma vez que o .NET 4.6 e o .NET 4.5.2 não dão suporte ao .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="a76e9-161">The PowerShell loading the module or library must be running a minimum of .NET 4.6.1; .NET 4.6 and .NET 4.5.2 do not support .NET Standard.</span></span> <span data-ttu-id="a76e9-162">Observe que uma versão mais nova do Windows PowerShell não implica uma versão mais nova do .NET Framework; o Windows PowerShell 5.1 pode ser executado no .NET 4.5.2.</span><span class="sxs-lookup"><span data-stu-id="a76e9-162">Note that a newer Windows PowerShell version does not mean a newer .NET Framework version; Windows PowerShell 5.1 may run on .NET 4.5.2.</span></span>
- <span data-ttu-id="a76e9-163">Para funcionar com um PowerShell executando o .NET Framework 4.7.1 ou abaixo, a implementação da [NETStandard.Library][] no .NET 4.6.1 precisa fornecer o netstandard.dll e outros assemblies de shim em versões mais antigas do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a76e9-163">In order to work with a PowerShell running .NET Framework 4.7.1 or below, the .NET 4.6.1 [NETStandard.Library][] implementation is required to provide the netstandard.dll and other shim assemblies in older .NET Framework versions.</span></span>

<span data-ttu-id="a76e9-164">O PowerShell 6+ fornece os próprios assemblies de shim para encaminhamento de tipo do .NET Framework 4.6.1 (e acima) para o .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a76e9-164">PowerShell 6+ provides its own shim assemblies for type forwarding from .NET Framework 4.6.1 (and above) to .NET Core.</span></span> <span data-ttu-id="a76e9-165">Isso significa que, desde que um módulo use apenas APIs existentes no .NET Core, o PowerShell 6+ poderá carregá-lo e executá-lo quando tiver sido criado para o .NET Framework 4.6.1 (o destino do runtime `net461`).</span><span class="sxs-lookup"><span data-stu-id="a76e9-165">This means that as long as a module uses only APIs that exist in .NET Core, PowerShell 6+ can load and run it when it has been built for .NET Framework 4.6.1 (the `net461` runtime target).</span></span>

<span data-ttu-id="a76e9-166">Isso significa que módulos binários que usam o PowerShell Standard para ter como destino várias versões do PowerShell com uma só DLL publicada têm duas opções:</span><span class="sxs-lookup"><span data-stu-id="a76e9-166">This means that binary modules using PowerShell Standard to target multiple PowerShell versions with a single published DLL have two options:</span></span>

1. <span data-ttu-id="a76e9-167">Publicar um assembly criado para o runtime do `net461` de destino.</span><span class="sxs-lookup"><span data-stu-id="a76e9-167">Publishing an assembly built for the `net461` target runtime.</span></span> <span data-ttu-id="a76e9-168">Isso envolve:</span><span class="sxs-lookup"><span data-stu-id="a76e9-168">This involves:</span></span>
   - <span data-ttu-id="a76e9-169">Publicar o projeto para o runtime do `net461`</span><span class="sxs-lookup"><span data-stu-id="a76e9-169">Publishing the project for the `net461` runtime</span></span>
   - <span data-ttu-id="a76e9-170">Além disso, compilar para o runtime do `netstandard2.0` (sem usar sua saída de build) para garantir que todas as APIs usadas também estejam presentes no .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a76e9-170">Also compiling against the `netstandard2.0` runtime (without using its build output) to ensure that all APIs used are also present in .NET Core.</span></span>

1. <span data-ttu-id="a76e9-171">Publicar um build de assembly para o runtime do `netstandard2.0` de destino.</span><span class="sxs-lookup"><span data-stu-id="a76e9-171">Publishing an assembly build for the `netstandard2.0` target runtime.</span></span> <span data-ttu-id="a76e9-172">Isso requer:</span><span class="sxs-lookup"><span data-stu-id="a76e9-172">This requires:</span></span>
   - <span data-ttu-id="a76e9-173">Publicar o projeto para o runtime do `netstandard2.0`</span><span class="sxs-lookup"><span data-stu-id="a76e9-173">Publishing the project for the `netstandard2.0` runtime</span></span>
   - <span data-ttu-id="a76e9-174">Pegar as dependências de `net461` de NETStandard.Library e copiá-las para o local de publicação do assembly do projeto para que o assembly seja corrigido com o encaminhamento do tipo para o .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a76e9-174">Taking the `net461` dependencies of NETStandard.Library and copying them into the project assembly's publish location so that the assembly is type-forwarded corrected in .NET Framework.</span></span>

<span data-ttu-id="a76e9-175">Para criar bibliotecas ou módulos do PowerShell direcionados a versões mais antigas do .NET Framework, pode ser preferível direcionar vários runtimes .NET.</span><span class="sxs-lookup"><span data-stu-id="a76e9-175">To build PowerShell modules or libraries targeting older .NET Framework versions, it may be preferable to target multiple .NET runtimes.</span></span> <span data-ttu-id="a76e9-176">Isso publicará um assembly para cada runtime de destino, e o assembly correto precisará ser carregado no tempo de carregamento do módulo (por exemplo, com um pequeno psm1 como módulo raiz).</span><span class="sxs-lookup"><span data-stu-id="a76e9-176">This will publish an assembly for each target runtime, and the correct assembly will need to be loaded at module load time (for example with a small psm1 as the root module).</span></span>

### <a name="testing-powershell-standard-projects-in-net"></a><span data-ttu-id="a76e9-177">Testando projetos do PowerShell Standard no .NET</span><span class="sxs-lookup"><span data-stu-id="a76e9-177">Testing PowerShell Standard projects in .NET</span></span>

<span data-ttu-id="a76e9-178">Quando se trata de testar seu módulo em executores de teste do .NET, como o xUnit, lembre-se de que as verificações de tempo de compilação têm limitações.</span><span class="sxs-lookup"><span data-stu-id="a76e9-178">When it comes to testing your module in .NET test runners like xUnit, remember that compile-time checks can only go so far.</span></span> <span data-ttu-id="a76e9-179">Você precisa testar o módulo com relação às plataformas relevantes do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-179">You must test your module against the relevant PowerShell platforms.</span></span>

<span data-ttu-id="a76e9-180">Para testar APIs criadas com o PowerShell Standard no .NET, adicione `Microsoft.Powershell.SDK` como uma dependência de teste com o .NET Core (com a versão configurada de modo correspondente com a versão desejada do PowerShell) e os assemblies de referência apropriados do Windows PowerShell com o .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a76e9-180">To test APIs built against PowerShell Standard in .NET, you should add `Microsoft.Powershell.SDK` as a testing dependency with .NET Core (with the version set to match the desired PowerShell version), and the appropriate Windows PowerShell reference assemblies with .NET Framework.</span></span>

<span data-ttu-id="a76e9-181">Para obter mais informações sobre o PowerShell Standard e como usá-lo para escrever um módulo binário que funciona em várias versões do PowerShell, confira [esta postagem no blog][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-181">For more information on PowerShell Standard and using it to write a binary module that works in multiple PowerShell versions, see [this blog post][].</span></span> <span data-ttu-id="a76e9-182">Confira também o [repositório do PowerShell Standard][] no GitHub.</span><span class="sxs-lookup"><span data-stu-id="a76e9-182">Also see the [PowerShell Standard repository][] on GitHub.</span></span>

## <a name="microsoftpowershellsdk"></a><span data-ttu-id="a76e9-183">Microsoft.PowerShell.SDK</span><span class="sxs-lookup"><span data-stu-id="a76e9-183">Microsoft.PowerShell.SDK</span></span>

<span data-ttu-id="a76e9-184">`Microsoft.PowerShell.SDK` é um metapacote que reúne todos os componentes do SDK do PowerShell em um só pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="a76e9-184">`Microsoft.PowerShell.SDK` is a meta-package that pulls together all of the components of the PowerShell SDK into a single NuGet package.</span></span> <span data-ttu-id="a76e9-185">Um aplicativo .NET autossuficiente pode usar o Microsoft.PowerShell.SDK para executar funcionalidades arbitrárias do PowerShell sem depender de nenhuma instalação ou biblioteca externas do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-185">A self-contained .NET application can use Microsoft.PowerShell.SDK to run arbitrary PowerShell functionality without depending on any external PowerShell installations or libraries.</span></span>

> [!NOTE]
> <span data-ttu-id="a76e9-186">O SDK do PowerShell se refere apenas a todos os pacotes de componentes que compõem o PowerShell e que podem ser usados para desenvolvimento do .NET com o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-186">The PowerShell SDK just refers to all the component packages that make up PowerShell, and which can be used for .NET development with PowerShell.</span></span>

<span data-ttu-id="a76e9-187">Uma determinada versão de `Microsoft.Powershell.SDK` contém a implementação concreta da mesma versão do aplicativo PowerShell; a versão 7.0 contém a implementação do PowerShell 7.0, e a execução de comandos ou scripts com ela se comportará, em grande parte, como a execução no PowerShell 7.0.</span><span class="sxs-lookup"><span data-stu-id="a76e9-187">A given `Microsoft.Powershell.SDK` version contains the concrete implementation of the same version of the PowerShell application; version 7.0 contains the implementation of PowerShell 7.0 and running commands or scripts with it will largely behave like running them in PowerShell 7.0.</span></span>

<span data-ttu-id="a76e9-188">Executar comandos do PowerShell no SDK é, na maioria dos casos, mas não em todos, o mesmo que executá-los em `pwsh`.</span><span class="sxs-lookup"><span data-stu-id="a76e9-188">Running PowerShell commands from the SDK is mostly, but not totally, the same as running them from `pwsh`.</span></span> <span data-ttu-id="a76e9-189">Por exemplo, [Start-Job][] atualmente depende da disponibilidade do executável `pwsh` e, portanto, não funcionará com `Microsoft.Powershell.SDK` por padrão.</span><span class="sxs-lookup"><span data-stu-id="a76e9-189">For example, [Start-Job][] currently depends on the `pwsh` executable being available, and so will not work with `Microsoft.Powershell.SDK` by default.</span></span>

<span data-ttu-id="a76e9-190">Ter `Microsoft.Powershell.SDK` como destino usando um aplicativo .NET permite que você integre com todos os assemblies de implementação do PowerShell, como `System.Management.Automation`, `Microsoft.PowerShell.Management` e outros assemblies de módulo.</span><span class="sxs-lookup"><span data-stu-id="a76e9-190">Targeting `Microsoft.Powershell.SDK` from a .NET application allows you to integrate with all of PowerShell's implementation assemblies, such as `System.Management.Automation`, `Microsoft.PowerShell.Management`, and other module assemblies.</span></span>

<span data-ttu-id="a76e9-191">Pulicar um aplicativo que tem `Microsoft.Powershell.SDK` como destino incluirá todos esses assemblies e as dependências que o PowerShell exige.</span><span class="sxs-lookup"><span data-stu-id="a76e9-191">Publishing an application targeting `Microsoft.Powershell.SDK` will include all these assemblies, and any dependencies PowerShell requires.</span></span> <span data-ttu-id="a76e9-192">Incluirá também outros ativos que o PowerShell exigiu em seu build, como os manifestos de módulo para módulos de `Microsoft.PowerShell.*` e o diretório `ref` exigido por [Add-Type][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-192">It will also include other assets that PowerShell required in its build, such as the module manifests for `Microsoft.PowerShell.*` modules and the `ref` directory required by [Add-Type][].</span></span>

<span data-ttu-id="a76e9-193">Por ser mais completo, `Microsoft.Powershell.SDK` é mais adequado para:</span><span class="sxs-lookup"><span data-stu-id="a76e9-193">Given the completeness of `Microsoft.Powershell.SDK`, it's best suited for:</span></span>

- <span data-ttu-id="a76e9-194">Implementação de hosts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-194">Implementation of PowerShell hosts.</span></span>
- <span data-ttu-id="a76e9-195">Teste com xUnit de bibliotecas com assemblies de referência do PowerShell como destino.</span><span class="sxs-lookup"><span data-stu-id="a76e9-195">xUnit testing of libraries targeting PowerShell reference assemblies.</span></span>
- <span data-ttu-id="a76e9-196">Invocar o PowerShell em processo de um aplicativo .NET.</span><span class="sxs-lookup"><span data-stu-id="a76e9-196">Invoking PowerShell in-process from a .NET application.</span></span>

<span data-ttu-id="a76e9-197">`Microsoft.PowerShell.SDK` também pode ser usado como um destino de referência quando um projeto .NET tem a finalidade de ser usado como um módulo ou, de alguma forma, ser carregado pelo PowerShell, mas depende de APIs presentes apenas em uma versão específica do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-197">`Microsoft.PowerShell.SDK` may also be used as a reference target when a .NET project is intended to be used as a module or otherwise loaded by PowerShell, but depends on APIs only present in a particular version of PowerShell.</span></span> <span data-ttu-id="a76e9-198">Observe que só é seguro carregar e usar um assembly publicado para uma versão específica do `Microsoft.PowerShell.SDK` nessa versão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-198">Note that an assembly published against a specific version of `Microsoft.PowerShell.SDK` will only be safe to load and use in that version of PowerShell.</span></span> <span data-ttu-id="a76e9-199">Para ter como destino várias versões do PowerShell com APIs específicas, vários builds são necessários, cada destinado à própria versão do `Microsoft.Powershell.SDK`.</span><span class="sxs-lookup"><span data-stu-id="a76e9-199">To target multiple PowerShell versions with specific APIs, multiple builds are required, each targeting their own version of `Microsoft.Powershell.SDK`.</span></span>

> [!NOTE]
> <span data-ttu-id="a76e9-200">O SDK do PowerShell está disponível apenas para o PowerShell versões 6 e superiores.</span><span class="sxs-lookup"><span data-stu-id="a76e9-200">The PowerShell SDK is only available for PowerShell versions 6 and up.</span></span> <span data-ttu-id="a76e9-201">Para fornecer funcionalidades equivalentes com o Windows PowerShell, use os assemblies de referência do Windows PowerShell descritos abaixo.</span><span class="sxs-lookup"><span data-stu-id="a76e9-201">To provide equivalent functionality with Windows PowerShell, use the Windows PowerShell reference assemblies described below.</span></span>

## <a name="systemmanagementautomation"></a><span data-ttu-id="a76e9-202">System.Management.Automation</span><span class="sxs-lookup"><span data-stu-id="a76e9-202">System.Management.Automation</span></span>

<span data-ttu-id="a76e9-203">O pacote `System.Management.Automation` é o coração do SDK do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-203">The `System.Management.Automation` package is the heart of the PowerShell SDK.</span></span> <span data-ttu-id="a76e9-204">Ele existe no NuGet, principalmente, como um ativo para que `Microsoft.Powershell.SDK` efetue pull.</span><span class="sxs-lookup"><span data-stu-id="a76e9-204">It exists on NuGet, primarily, as an asset for `Microsoft.Powershell.SDK` to pull in.</span></span> <span data-ttu-id="a76e9-205">No entanto, ele também pode ser usado diretamente como um pacote para cenários de hospedagem menores e módulos direcionados a versões.</span><span class="sxs-lookup"><span data-stu-id="a76e9-205">However, it can also be used directly as a package for smaller hosting scenarios and version-targeting modules.</span></span>

<span data-ttu-id="a76e9-206">Especificamente, o pacote `System.Management.Automation` pode ser um provedor preferível de funcionalidades do PowerShell quando:</span><span class="sxs-lookup"><span data-stu-id="a76e9-206">Specifically, the `System.Management.Automation` package may be a preferable provider of PowerShell functionality when:</span></span>

- <span data-ttu-id="a76e9-207">Você quer usar apenas a funcionalidade de linguagem do PowerShell (no namespace `System.Management.Automation.Language`), como o analisador do PowerShell, o AST e as APIs de visitante do AST (por exemplo, para análise estática do PowerShell).</span><span class="sxs-lookup"><span data-stu-id="a76e9-207">You're only looking to use PowerShell language functionality (in the `System.Management.Automation.Language` namespace) like the PowerShell parser, AST, and AST visitor APIs (for example for static analysis of PowerShell).</span></span>
- <span data-ttu-id="a76e9-208">Você deseja apenas executar comandos específicos do módulo `Microsoft.PowerShell.Core` e pode executá-los em um estado de sessão criado com o método de fábrica [CreateDefault2][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-208">You only wish to execute specific commands from the `Microsoft.PowerShell.Core` module and can execute them in a session state created with the [CreateDefault2][] factory method.</span></span>

<span data-ttu-id="a76e9-209">Além disso, `System.Management.Automation` é um assembly de referência útil quando:</span><span class="sxs-lookup"><span data-stu-id="a76e9-209">Additionally, `System.Management.Automation` is a useful reference assembly when:</span></span>

- <span data-ttu-id="a76e9-210">Você deseja ter como alvo APIs que estão presentes apenas dentro de uma versão específica do PowerShell</span><span class="sxs-lookup"><span data-stu-id="a76e9-210">You wish to target APIs that are only present within a specific PowerShell version</span></span>
- <span data-ttu-id="a76e9-211">Você não vai depender de tipos que ocorrem fora do assembly `System.Management.Automation` (por exemplo, tipos exportados por cmdlets em módulos `Microsoft.PowerShell.*`).</span><span class="sxs-lookup"><span data-stu-id="a76e9-211">You won't be depending on types occurring outside the `System.Management.Automation` assembly (for example, types exported by cmdlets in `Microsoft.PowerShell.*` modules).</span></span>

## <a name="windows-powershell-reference-assemblies"></a><span data-ttu-id="a76e9-212">Assemblies de referência do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a76e9-212">Windows PowerShell reference assemblies</span></span>

<span data-ttu-id="a76e9-213">Para as versões 5.1 e anteriores do PowerShell (Windows PowerShell), não há nenhum SDK para fornecer uma implementação do PowerShell, uma vez que a implementação do Windows PowerShell faz parte do Windows.</span><span class="sxs-lookup"><span data-stu-id="a76e9-213">For PowerShell versions 5.1 and older (Windows PowerShell), there is no SDK to provide an implementation of PowerShell, since Windows PowerShell's implementation is a part of Windows.</span></span>

<span data-ttu-id="a76e9-214">Em vez disso, os assemblies de referência do Windows PowerShell fornecem destinos de referência e uma forma de hospedar novamente o Windows PowerShell, atuando da mesma forma que o SDK do PowerShell para as versões 6 e superiores.</span><span class="sxs-lookup"><span data-stu-id="a76e9-214">Instead, the Windows PowerShell reference assemblies provide both reference targets and a way to rehost Windows PowerShell, acting the same as the PowerShell SDK does for versions 6 and up.</span></span>

<span data-ttu-id="a76e9-215">Em vez de serem diferenciados pela versão, os assemblies de referência do Windows PowerShell têm um pacote diferente para cada versão do Windows PowerShell:</span><span class="sxs-lookup"><span data-stu-id="a76e9-215">Rather than being differentiated by version, Windows PowerShell reference assemblies have a different package for each version of Windows PowerShell:</span></span>

- [<span data-ttu-id="a76e9-216">PowerShell 5.1</span><span class="sxs-lookup"><span data-stu-id="a76e9-216">PowerShell 5.1</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.5.ReferenceAssemblies/)
- [<span data-ttu-id="a76e9-217">PowerShell 4</span><span class="sxs-lookup"><span data-stu-id="a76e9-217">PowerShell 4</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.4.ReferenceAssemblies/)
- [<span data-ttu-id="a76e9-218">PowerShell 3</span><span class="sxs-lookup"><span data-stu-id="a76e9-218">PowerShell 3</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.3.ReferenceAssemblies/)

<span data-ttu-id="a76e9-219">Informações sobre como usar os assemblies de referência do Windows PowerShell podem ser encontradas em [SDK do Windows PowerShell][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-219">Information on how to use the Windows PowerShell reference assemblies can be found in the [Windows PowerShell SDK][].</span></span>

## <a name="real-world-examples-using-these-nuget-packages"></a><span data-ttu-id="a76e9-220">Exemplos reais de uso desses pacotes NuGet</span><span class="sxs-lookup"><span data-stu-id="a76e9-220">Real-world examples using these NuGet packages</span></span>

<span data-ttu-id="a76e9-221">Diferentes projetos de ferramentas do PowerShell têm como destino diferentes pacotes NuGet do PowerShell, dependendo de suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="a76e9-221">Different PowerShell tooling projects target different PowerShell NuGet packages depending on their needs.</span></span> <span data-ttu-id="a76e9-222">Veja alguns exemplos notáveis.</span><span class="sxs-lookup"><span data-stu-id="a76e9-222">Listed here are some notable examples.</span></span>

### <a name="psreadline"></a><span data-ttu-id="a76e9-223">PSReadLine</span><span class="sxs-lookup"><span data-stu-id="a76e9-223">PSReadLine</span></span>

<span data-ttu-id="a76e9-224">[PSReadLine][], o módulo do PowerShell que fornece grande parte da experiência de console avançada do PowerShell, usa o PowerShell Standard como uma dependência, e não como uma versão específica do PowerShell, e tem como alvo o runtime do .NET `net461` em seu [csproj][].</span><span class="sxs-lookup"><span data-stu-id="a76e9-224">[PSReadLine][], the PowerShell module that provides much of PowerShell's rich console experience, targets PowerShell Standard as a dependency rather than a specific PowerShell version, and targets the `net461` .NET runtime in its [csproj][].</span></span>

<span data-ttu-id="a76e9-225">O PowerShell 6+ fornece seus próprios assemblies de shim que permitem que uma DLL que tem como alvo o runtime de `net461` "simplesmente funcione" quando carregada (redirecionando a associação a `mscorlib.dll` do .NET Framework para o assembly do .NET Core relevante).</span><span class="sxs-lookup"><span data-stu-id="a76e9-225">PowerShell 6+ supplies its own shim assemblies that allow a DLL targeting the `net461` runtime to "just work" when loaded in (by redirecting binding to .NET Framework's `mscorlib.dll` to the relevant .NET Core assembly).</span></span>

<span data-ttu-id="a76e9-226">Isso simplifica significativamente o layout e a entrega do módulo de PSReadLine, uma vez que o PowerShell Standard garante que as únicas APIs usadas estejam presentes no PowerShell 5.1 e no PowerShell 6+, enquanto permite também que o módulo seja fornecido com somente um assembly.</span><span class="sxs-lookup"><span data-stu-id="a76e9-226">This simplifies PSReadLine's module layout and delivery significantly, since PowerShell Standard ensures the only APIs used will be present in both PowerShell 5.1 and PowerShell 6+, while also allowing the module to ship with only a single assembly.</span></span>

<span data-ttu-id="a76e9-227">No entanto, o destino .NET 4.6.1 significa que o Windows PowerShell em execução no .NET 4.5.2 e no .NET 4.6 não tem suporte.</span><span class="sxs-lookup"><span data-stu-id="a76e9-227">The .NET 4.6.1 target does mean that Windows PowerShell running on .NET 4.5.2 and .NET 4.6 is not supported though.</span></span>

### <a name="powershell-editor-services"></a><span data-ttu-id="a76e9-228">Serviços do Editor do PowerShell</span><span class="sxs-lookup"><span data-stu-id="a76e9-228">PowerShell Editor Services</span></span>

<span data-ttu-id="a76e9-229">O [PSES (Serviços do Editor do PowerShell)][] é o back-end da [extensão do PowerShell][] para o [Visual Studio Code][] e, na verdade, é uma forma de módulo do PowerShell que é carregada por um executável do PowerShell e, em seguida, assume esse processo para hospedar novamente o PowerShell dentro de si mesmo, enquanto fornece também recursos de Protocolo de Serviço de Linguagem e Adaptador de Depuração.</span><span class="sxs-lookup"><span data-stu-id="a76e9-229">[PowerShell Editor Services][] (PSES) is the backend for the [PowerShell extension][] for [Visual Studio Code][], and is actually a form of PowerShell module that gets loaded by a PowerShell executable and then takes over that process to rehost PowerShell within itself while also providing Language Service Protocol and Debug Adapter features.</span></span>

<span data-ttu-id="a76e9-230">O PSES fornece destinos de implementação concretos para `netcoreapp2.1` ter como destino o PowerShell 6+ (já que o runtime `netcoreapp3.1` do PowerShell 7 é compatível com versões anteriores) e `net461` ter como destino o Windows PowerShell 5.1, mas mantém a maior parte de sua lógica em um segundo assembly que tem como destino `netstandard2.0` e o PowerShell Standard.</span><span class="sxs-lookup"><span data-stu-id="a76e9-230">PSES provides concrete implementation targets for `netcoreapp2.1` to target PowerShell 6+ (since PowerShell 7's `netcoreapp3.1` runtime is backwards compatible) and `net461` to target Windows PowerShell 5.1, but contains most of its logic in a second assembly that targets `netstandard2.0` and PowerShell Standard.</span></span> <span data-ttu-id="a76e9-231">Isso permite que ele efetue pull das dependências necessárias para as plataformas .NET Core e .NET Framework, ao mesmo tempo em que simplifica a maior parte da base de código por trás de uma abstração uniforme.</span><span class="sxs-lookup"><span data-stu-id="a76e9-231">This allows it to pull in dependencies required for .NET Core and .NET Framework platforms, while still simplifying most of the codebase behind a uniform abstraction.</span></span>

<span data-ttu-id="a76e9-232">Por ser baseado no PowerShell Standard, o PSES requer uma implementação de runtime do PowerShell para ser testado corretamente.</span><span class="sxs-lookup"><span data-stu-id="a76e9-232">Because it is built against PowerShell Standard, PSES requires a runtime implementation of PowerShell in order to be tested correctly.</span></span> <span data-ttu-id="a76e9-233">Para fazer isso, os testes de [xUnit do PSES][] efetuam pull de `Microsoft.PowerShell.SDK` e `Microsoft.PowerShell.5.ReferenceAssemblies` para fornecer uma implementação do PowerShell no ambiente de teste.</span><span class="sxs-lookup"><span data-stu-id="a76e9-233">To do this, [PSES's xUnit][] tests pull in `Microsoft.PowerShell.SDK` and `Microsoft.PowerShell.5.ReferenceAssemblies` in order to provide a PowerShell implementation in the test environment.</span></span>

<span data-ttu-id="a76e9-234">Assim como ocorre com PSReadLine, o PSES não dá suporte ao .NET 4.6 e versões anteriores, mas [executa uma verificação][] no runtime antes de chamar qualquer uma das APIs que poderiam causar falha nos runtimes anteriores do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a76e9-234">As with PSReadLine, PSES cannot support .NET 4.6 and below, but it [performs a check][] at runtime before calling any of the APIs that could cause a crash on the lower .NET Framework runtimes.</span></span>

### <a name="psscriptanalyzer"></a><span data-ttu-id="a76e9-235">PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="a76e9-235">PSScriptAnalyzer</span></span>

<span data-ttu-id="a76e9-236">[PSScriptAnalyzer][], o linter do PowerShell, deve ter como destino elementos sintáticos introduzidos apenas em determinadas versões do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-236">[PSScriptAnalyzer][], the linter for PowerShell, must target syntactic elements only introduced in certain versions of PowerShell.</span></span> <span data-ttu-id="a76e9-237">Como o reconhecimento desses elementos sintáticos é realizado implementando um [AstVisitor2][], não é possível usar o PowerShellStandard e também implementar os métodos de visitante do AST para sintaxes mais recentes do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-237">Because recognition of these syntactic elements is accomplished by implementing an [AstVisitor2][], it's not possible to use PowerShellStandard and also implement AST visitor methods for newer PowerShell syntaxes.</span></span>

<span data-ttu-id="a76e9-238">Em vez disso, PSScriptAnalyzer [tem como destino cada versão do PowerShell][] como uma configuração de build e produz uma DLL separada para cada uma delas.</span><span class="sxs-lookup"><span data-stu-id="a76e9-238">Instead, PSScriptAnalyzer [targets each PowerShell version][] as a build configuration, and produces a separate DLL for each of them.</span></span> <span data-ttu-id="a76e9-239">Isso aumenta o tamanho e a complexidade do build, mas permite:</span><span class="sxs-lookup"><span data-stu-id="a76e9-239">This increases build size and complexity, but allows:</span></span>

- <span data-ttu-id="a76e9-240">Testes de APIs específicas da versão</span><span class="sxs-lookup"><span data-stu-id="a76e9-240">Version-specific API targeting</span></span>
- <span data-ttu-id="a76e9-241">A implementação de funcionalidades específicas da versão basicamente sem custo de runtime</span><span class="sxs-lookup"><span data-stu-id="a76e9-241">Version-specific functionality to be implemented with essentially no runtime cost</span></span>
- <span data-ttu-id="a76e9-242">Suporte total para o Windows PowerShell até o .NET Framework 4.5.2</span><span class="sxs-lookup"><span data-stu-id="a76e9-242">Total support for Windows PowerShell all the way down to .NET Framework 4.5.2</span></span>

## <a name="summary"></a><span data-ttu-id="a76e9-243">Resumo</span><span class="sxs-lookup"><span data-stu-id="a76e9-243">Summary</span></span>

<span data-ttu-id="a76e9-244">Neste artigo, listamos e falamos sobre os pacotes do NuGet disponíveis como destino ao implementar um projeto do .NET que usa o PowerShell, bem como sobre os motivos que você pode ter para usar um em vez do outro.</span><span class="sxs-lookup"><span data-stu-id="a76e9-244">In this article, we've listed and discussed the NuGet packages available to target when implementing a .NET project that uses PowerShell, and the reasons you might have for using one over another.</span></span>

<span data-ttu-id="a76e9-245">Se você veio direto para o resumo, algumas recomendações gerais são:</span><span class="sxs-lookup"><span data-stu-id="a76e9-245">If you've skipped to the summary, some broad recommendations are:</span></span>

- <span data-ttu-id="a76e9-246">Os **módulos** do PowerShell deverão ser compilados com o PowerShell Standard se exigirem apenas APIs comuns a versões diferentes do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-246">PowerShell **modules** should compile against PowerShell Standard if they only require APIs common to different PowerShell versions.</span></span>
- <span data-ttu-id="a76e9-247">**Hosts e aplicativos** do PowerShell que precisam executar o PowerShell internamente devem ter como destino o SDK do PowerShell para o PowerShell 6+ ou os assemblies de referência relevantes do Windows PowerShell para o Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a76e9-247">PowerShell **hosts and applications** that need to run PowerShell internally should target the PowerShell SDK for PowerShell 6+ or the relevant Windows PowerShell reference assemblies for Windows PowerShell.</span></span>
- <span data-ttu-id="a76e9-248">Os módulos do PowerShell que precisam de **APIs específicas da versão** devem ter como destino os assemblies de referência do SDK do PowerShell ou do Windows PowerShell para as versões necessárias do PowerShell, usando-os como assemblies de referência (ou seja, sem publicar as dependências do PowerShell).</span><span class="sxs-lookup"><span data-stu-id="a76e9-248">PowerShell modules that need **version-specific APIs** should target the PowerShell SDK or Windows PowerShell reference assemblies for the required PowerShell versions, using them as reference assemblies (that is, not publishing the PowerShell dependencies).</span></span>

<!--link references -->

[.NET Standard 2.0]: /dotnet/standard/net-standard
[about_Modules]: /powershell/module/microsoft.powershell.core/about/about_modules
[Add-Type]: /powershell/module/microsoft.powershell.utility/add-type
[AstVisitor2]: /dotnet/api/system.management.automation.language.astvisitor2
[CmdletProvider]: /dotnet/api/system.management.automation.provider.cmdletprovider
[CreateDefault2]: /dotnet/api/system.management.automation.runspaces.initialsessionstate.createdefault2
[csproj]: https://github.com/PowerShell/PSReadLine/blob/master/PSReadLine/PSReadLine.csproj
[Microsoft.PowerShell.SDK]: https://www.nuget.org/packages/Microsoft.PowerShell.SDK/
[NETStandard.Library]: https://www.nuget.org/packages/NETStandard.Library/
[NuGet]: https://www.nuget.org/
[executa uma verificação]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[performs a check]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[Pester]: https://github.com/Pester/Pester
[Serviços do Editor do PowerShell]: https://github.com/PowerShell/PowerShellEditorServices/
[PowerShell Editor Services]: https://github.com/PowerShell/PowerShellEditorServices/
[Extensão do PowerShell]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[PowerShell extension]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[NuGet do PowerShell]: https://www.nuget.org/packages/PowerShell/
[PowerShell NuGet]: https://www.nuget.org/packages/PowerShell/
[Repositório do PowerShell Standard]: https://github.com/PowerShell/PowerShellStandard
[PowerShell Standard repository]: https://github.com/PowerShell/PowerShellStandard
[PowerShellStandard.Library]: https://www.nuget.org/packages/PowerShellStandard.Library/
[PSCmdlet]: /dotnet/api/system.management.automation.pscmdlet
[XUnit do PSES]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSES's xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSHost]: /dotnet/api/system.management.automation.host.pshost
[Atributo PrivateAssets]: /dotnet/core/tools/csproj#packagereference
[PrivateAssets attribute]: /dotnet/core/tools/csproj#packagereference
[PSReadLine]: https://github.com/PowerShell/PSReadLine
[PSScriptAnalyzer]: https://github.com/powershell/psscriptanalyzer
[assemblies de referência]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[reference assemblies]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[Start-Job]: /powershell/module/microsoft.powershell.core/start-job
[System.Management.Automation]: https://www.nuget.org/packages/System.Management.Automation/
[tem como destino cada versão do PowerShell]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[targets each PowerShell version]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[esta postagem no blog]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[this blog post]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[Visual Studio Code]: https://code.visualstudio.com/
[SDK do Windows PowerShell]: /powershell/scripting/developer/windows-powershell
[Windows PowerShell SDK]: /powershell/scripting/developer/windows-powershell
