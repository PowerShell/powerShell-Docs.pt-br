---
ms.date: 09/13/2016
ms.topic: reference
title: Criar um provedor básico do Windows PowerShell
description: Criar um provedor básico do Windows PowerShell
ms.openlocfilehash: 03b5784fd063b5457fc64d92a32e286e3bf9cce4
ms.sourcegitcommit: ba7315a496986451cfc1296b659d73ea2373d3f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/10/2020
ms.locfileid: "92647508"
---
# <a name="creating-a-basic-windows-powershell-provider"></a><span data-ttu-id="a1d6a-103">Criar um provedor básico do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1d6a-103">Creating a Basic Windows PowerShell Provider</span></span>

<span data-ttu-id="a1d6a-104">Este tópico é o ponto de partida para aprender a criar um provedor do Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-104">This topic is the starting point for learning how to create a Windows PowerShell provider.</span></span> <span data-ttu-id="a1d6a-105">O provedor básico descrito aqui fornece métodos para iniciar e interromper o provedor e, embora esse provedor não forneça um meio para acessar um armazenamento de dados ou obter ou definir os dados no repositório de dados, ele fornece a funcionalidade básica exigida por todos os provedores.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-105">The basic provider described here provides methods for starting and stopping the provider, and although this provider does not provide a means to access a data store or to get or set the data in the data store, it does provide the basic functionality that is required by all providers.</span></span>

<span data-ttu-id="a1d6a-106">Conforme mencionado anteriormente, o provedor básico descrito aqui implementa métodos para iniciar e parar o provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-106">As mentioned previously, the basic provider described here implements methods for starting and stopping the provider.</span></span> <span data-ttu-id="a1d6a-107">O tempo de execução do Windows PowerShell chama esses métodos para inicializar e cancelar a inicialização do provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-107">The Windows PowerShell runtime calls these methods to initialize and uninitialize the provider.</span></span>

> [!NOTE]
> <span data-ttu-id="a1d6a-108">Você pode encontrar um exemplo desse provedor no arquivo AccessDBSampleProvider01.cs fornecido pelo Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-108">You can find a sample of this provider in the AccessDBSampleProvider01.cs file provided by Windows PowerShell.</span></span>

## <a name="defining-the-windows-powershell-provider-class"></a><span data-ttu-id="a1d6a-109">Definindo a classe do provedor do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1d6a-109">Defining the Windows PowerShell Provider Class</span></span>

<span data-ttu-id="a1d6a-110">A primeira etapa na criação de um provedor do Windows PowerShell é definir sua classe .NET.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-110">The first step in creating a Windows PowerShell provider is to define its .NET class.</span></span> <span data-ttu-id="a1d6a-111">Esse provedor básico define uma classe chamada `AccessDBProvider` derivada da classe base [System. Management. Automation. Provider. cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) .</span><span class="sxs-lookup"><span data-stu-id="a1d6a-111">This basic provider defines a class called `AccessDBProvider` that derives from the [System.Management.Automation.Provider.Cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) base class.</span></span>

<span data-ttu-id="a1d6a-112">É recomendável que você coloque suas classes de provedor em um `Providers` namespace do seu namespace de API, por exemplo, XXX. PowerShell. Providers.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-112">It is recommended that you place your provider classes in a `Providers` namespace of your API namespace, for example, xxx.PowerShell.Providers.</span></span> <span data-ttu-id="a1d6a-113">Esse provedor usa o `Microsoft.Samples.PowerShell.Provider` namespace, no qual todos os exemplos de provedor do Windows PowerShell são executados.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-113">This provider uses the `Microsoft.Samples.PowerShell.Provider` namespace, in which all Windows PowerShell provider samples run.</span></span>

> [!NOTE]
> <span data-ttu-id="a1d6a-114">A classe para um provedor do Windows PowerShell deve ser explicitamente marcada como pública.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-114">The class for a Windows PowerShell provider must be explicitly marked as public.</span></span> <span data-ttu-id="a1d6a-115">As classes não marcadas como públicas usarão como padrão o interno e não serão encontradas pelo tempo de execução do Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-115">Classes not marked as public will default to internal and will not be found by the Windows PowerShell runtime.</span></span>

<span data-ttu-id="a1d6a-116">Aqui está a definição de classe para este provedor básico:</span><span class="sxs-lookup"><span data-stu-id="a1d6a-116">Here is the class definition for this basic provider:</span></span>

:::code language="csharp" source="~/../powershell-sdk-samples/SDK-2.0/csharp/AccessDBProviderSample01/AccessDBProviderSample01.cs" range="23-24":::

<span data-ttu-id="a1d6a-117">Logo antes da definição de classe, você deve declarar o atributo [System. Management. Automation. Provider. Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) com a sintaxe [cmdletprovider ()].</span><span class="sxs-lookup"><span data-stu-id="a1d6a-117">Right before the class definition, you must declare the [System.Management.Automation.Provider.Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) attribute, with the syntax [CmdletProvider()].</span></span>

<span data-ttu-id="a1d6a-118">Você pode definir palavras-chave de atributo para declarar ainda mais a classe, se necessário.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-118">You can set attribute keywords to further declare the class if necessary.</span></span> <span data-ttu-id="a1d6a-119">Observe que o atributo [System. Management. Automation. Provider. Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) declarado aqui inclui dois parâmetros.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-119">Notice that the [System.Management.Automation.Provider.Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) attribute declared here includes two parameters.</span></span> <span data-ttu-id="a1d6a-120">O primeiro parâmetro de atributo especifica o nome amigável padrão para o provedor, que o usuário pode modificar mais tarde.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-120">The first attribute parameter specifies the default-friendly name for the provider, which the user can modify later.</span></span> <span data-ttu-id="a1d6a-121">O segundo parâmetro especifica os recursos definidos pelo Windows PowerShell que o provedor expõe para o tempo de execução do Windows PowerShell durante o processamento do comando.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-121">The second parameter specifies the Windows PowerShell-defined capabilities that the provider exposes to the Windows PowerShell runtime during command processing.</span></span> <span data-ttu-id="a1d6a-122">Os valores possíveis para os recursos do provedor são definidos pela enumeração [System. Management. Automation. Provider. Providercapabilities](/dotnet/api/System.Management.Automation.Provider.ProviderCapabilities) .</span><span class="sxs-lookup"><span data-stu-id="a1d6a-122">The possible values for the provider capabilities are defined by the [System.Management.Automation.Provider.Providercapabilities](/dotnet/api/System.Management.Automation.Provider.ProviderCapabilities) enumeration.</span></span> <span data-ttu-id="a1d6a-123">Como esse é um provedor base, ele não oferece suporte a recursos.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-123">Because this is a base provider, it supports no capabilities.</span></span>

> [!NOTE]
> <span data-ttu-id="a1d6a-124">O nome totalmente qualificado do provedor do Windows PowerShell inclui o nome do assembly e outros atributos determinados pelo Windows PowerShell após o registro do provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-124">The fully qualified name of the Windows PowerShell provider includes the assembly name and other attributes determined by Windows PowerShell upon registration of the provider.</span></span>

## <a name="defining-provider-specific-state-information"></a><span data-ttu-id="a1d6a-125">Definindo informações de estado de Provider-Specific</span><span class="sxs-lookup"><span data-stu-id="a1d6a-125">Defining Provider-Specific State Information</span></span>

<span data-ttu-id="a1d6a-126">A classe base [System. Management. Automation. Provider. cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) e todas as classes derivadas são consideradas sem estado porque o tempo de execução do Windows PowerShell cria instâncias de provedor somente conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-126">The [System.Management.Automation.Provider.Cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) base class and all derived classes are considered stateless because the Windows PowerShell runtime creates provider instances only as required.</span></span> <span data-ttu-id="a1d6a-127">Portanto, se seu provedor exigir controle total e manutenção de estado para dados específicos do provedor, ele deverá derivar uma classe da classe [System. Management. Automation. providerInfo](/dotnet/api/System.Management.Automation.ProviderInfo) .</span><span class="sxs-lookup"><span data-stu-id="a1d6a-127">Therefore, if your provider requires full control and state maintenance for provider-specific data, it must derive a class from the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) class.</span></span> <span data-ttu-id="a1d6a-128">Sua classe derivada deve definir os membros necessários para manter o estado de forma que os dados específicos do provedor possam ser acessados quando o tempo de execução do Windows PowerShell chama o método [System. Management. Automation. Provider. cmdletprovider. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) para inicializar o provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-128">Your derived class should define the members necessary to maintain the state so that the provider-specific data can be accessed when the Windows PowerShell runtime calls the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method to initialize the provider.</span></span>

<span data-ttu-id="a1d6a-129">Um provedor do Windows PowerShell também pode manter o estado baseado em conexão.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-129">A Windows PowerShell provider can also maintain connection-based state.</span></span> <span data-ttu-id="a1d6a-130">Para obter mais informações sobre como manter o estado de conexão, consulte [criando um provedor de unidade do PowerShell](./creating-a-windows-powershell-drive-provider.md).</span><span class="sxs-lookup"><span data-stu-id="a1d6a-130">For more information about maintaining connection state, see [Creating a PowerShell Drive Provider](./creating-a-windows-powershell-drive-provider.md).</span></span>

## <a name="initializing-the-provider"></a><span data-ttu-id="a1d6a-131">Inicializando o provedor</span><span class="sxs-lookup"><span data-stu-id="a1d6a-131">Initializing the Provider</span></span>

<span data-ttu-id="a1d6a-132">Para inicializar o provedor, o tempo de execução do Windows PowerShell chama o método [System. Management. Automation. Provider. cmdletprovider. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) quando o Windows PowerShell é iniciado.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-132">To initialize the provider, the Windows PowerShell runtime calls the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method when Windows PowerShell is started.</span></span> <span data-ttu-id="a1d6a-133">Para a maior parte, seu provedor pode usar a implementação padrão desse método, que simplesmente retorna o objeto [System. Management. Automation. providerInfo](/dotnet/api/System.Management.Automation.ProviderInfo) que descreve seu provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-133">For the most part, your provider can use the default implementation of this method, which simply returns the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that describes your provider.</span></span> <span data-ttu-id="a1d6a-134">No entanto, no caso em que você deseja adicionar informações de inicialização adicionais, você deve implementar seu próprio método [System. Management. Automation. Provider. cmdletprovider. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) que retorna uma versão modificada do objeto [System. Management. Automation. providerInfo](/dotnet/api/System.Management.Automation.ProviderInfo) que é passado para seu provedor.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-134">However, in the case where you want to add additional initialization information, you should implement your own [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method that returns a modified version of the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that is passed to your provider.</span></span> <span data-ttu-id="a1d6a-135">Em geral, esse método deve retornar o objeto [System. Management. Automation. providerInfo](/dotnet/api/System.Management.Automation.ProviderInfo) fornecido passado a ele ou um objeto [System. Management. Automation. providerInfo](/dotnet/api/System.Management.Automation.ProviderInfo) modificado que contém outras informações de inicialização.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-135">In general, this method should return the provided [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object passed to it or a modified [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that contains other initialization information.</span></span>

<span data-ttu-id="a1d6a-136">Este provedor básico não substitui esse método.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-136">This basic provider does not override this method.</span></span> <span data-ttu-id="a1d6a-137">No entanto, o código a seguir mostra a implementação padrão desse método:</span><span class="sxs-lookup"><span data-stu-id="a1d6a-137">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderStart](Msh_samplesaccessdbprov01#accessdbprov01ProviderStart)]  -->

<span data-ttu-id="a1d6a-138">O provedor pode manter o estado das informações específicas do provedor, conforme descrito em [definindo o estado de dados específicos do provedor](#defining-provider-specific-state-information).</span><span class="sxs-lookup"><span data-stu-id="a1d6a-138">The provider can maintain the state of provider-specific information as described in [Defining Provider-specific Data State](#defining-provider-specific-state-information).</span></span> <span data-ttu-id="a1d6a-139">Nesse caso, sua implementação deve substituir o método [System. Management. Automation. Provider. cmdletprovider. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) para retornar uma instância da classe derivada.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-139">In this case, your implementation must override the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method to return an instance of the derived class.</span></span>

## <a name="start-dynamic-parameters"></a><span data-ttu-id="a1d6a-140">Iniciar parâmetros dinâmicos</span><span class="sxs-lookup"><span data-stu-id="a1d6a-140">Start Dynamic Parameters</span></span>

<span data-ttu-id="a1d6a-141">A implementação do provedor do método [System. Management. Automation. Provider. cmdletprovider. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) pode exigir parâmetros adicionais.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-141">Your provider implementation of the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method might require additional parameters.</span></span> <span data-ttu-id="a1d6a-142">Nesse caso, o provedor deve substituir o método [System. Management. Automation. Provider. cmdletprovider. Startdynamicparameters \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.StartDynamicParameters) e retornar um objeto que tenha propriedades e campos com atributos de análise semelhantes a uma classe de cmdlet ou a um objeto [System. Management. Automation. Runtimedefinedparameterdictionary](/dotnet/api/System.Management.Automation.RuntimeDefinedParameterDictionary) .</span><span class="sxs-lookup"><span data-stu-id="a1d6a-142">In this case, the provider should override the [System.Management.Automation.Provider.Cmdletprovider.Startdynamicparameters\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.StartDynamicParameters) method and return an object that has properties and fields with parsing attributes similar to a cmdlet class or a [System.Management.Automation.Runtimedefinedparameterdictionary](/dotnet/api/System.Management.Automation.RuntimeDefinedParameterDictionary) object.</span></span>

<span data-ttu-id="a1d6a-143">Este provedor básico não substitui esse método.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-143">This basic provider does not override this method.</span></span> <span data-ttu-id="a1d6a-144">No entanto, o código a seguir mostra a implementação padrão desse método:</span><span class="sxs-lookup"><span data-stu-id="a1d6a-144">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderDynamicParameters](Msh_samplesaccessdbprov01#accessdbprov01ProviderDynamicParameters)]  -->

## <a name="uninitializing-the-provider"></a><span data-ttu-id="a1d6a-145">Cancelando a inicialização do provedor</span><span class="sxs-lookup"><span data-stu-id="a1d6a-145">Uninitializing the Provider</span></span>

<span data-ttu-id="a1d6a-146">Para liberar recursos que o provedor do Windows PowerShell usa, seu provedor deve implementar seu próprio método [System. Management. Automation. Provider. cmdletprovider. Stop \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Stop) .</span><span class="sxs-lookup"><span data-stu-id="a1d6a-146">To free resources that the Windows PowerShell provider uses, your provider should implement its own [System.Management.Automation.Provider.Cmdletprovider.Stop\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Stop) method.</span></span> <span data-ttu-id="a1d6a-147">Esse método é chamado pelo tempo de execução do Windows PowerShell para cancelar a inicialização do provedor no fechamento de uma sessão.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-147">This method is called by the Windows PowerShell runtime to uninitialize the provider at the close of a session.</span></span>

<span data-ttu-id="a1d6a-148">Este provedor básico não substitui esse método.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-148">This basic provider does not override this method.</span></span> <span data-ttu-id="a1d6a-149">No entanto, o código a seguir mostra a implementação padrão desse método:</span><span class="sxs-lookup"><span data-stu-id="a1d6a-149">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderStop](Msh_samplesaccessdbprov01#accessdbprov01ProviderStop)]  -->

## <a name="code-sample"></a><span data-ttu-id="a1d6a-150">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="a1d6a-150">Code Sample</span></span>

<span data-ttu-id="a1d6a-151">Para obter o código de exemplo completo, consulte [exemplo de código AccessDbProviderSample01](./accessdbprovidersample01-code-sample.md).</span><span class="sxs-lookup"><span data-stu-id="a1d6a-151">For complete sample code, see [AccessDbProviderSample01 Code Sample](./accessdbprovidersample01-code-sample.md).</span></span>

## <a name="testing-the-windows-powershell-provider"></a><span data-ttu-id="a1d6a-152">Testando o provedor do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1d6a-152">Testing the Windows PowerShell Provider</span></span>

<span data-ttu-id="a1d6a-153">Depois que o provedor do Windows PowerShell tiver sido registrado com o Windows PowerShell, você poderá testá-lo executando os cmdlets com suporte na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-153">Once your Windows PowerShell provider has been registered with Windows PowerShell, you can test it by running the supported cmdlets on the command line.</span></span> <span data-ttu-id="a1d6a-154">Para este provedor básico, execute o novo shell e use o `Get-PSProvider` cmdlet para recuperar a lista de provedores e verifique se o provedor AccessDb está presente.</span><span class="sxs-lookup"><span data-stu-id="a1d6a-154">For this basic provider, run the new shell and use the `Get-PSProvider` cmdlet to retrieve the list of providers and ensure that the AccessDb provider is present.</span></span>

```powershell
Get-PSProvider
```

<span data-ttu-id="a1d6a-155">O seguinte resultado é exibido:</span><span class="sxs-lookup"><span data-stu-id="a1d6a-155">The following output appears:</span></span>

```Output
Name                 Capabilities                  Drives
----                 ------------                  ------
AccessDb             None                          {}
Alias                ShouldProcess                 {Alias}
Environment          ShouldProcess                 {Env}
FileSystem           Filter, ShouldProcess         {C, Z}
Function             ShouldProcess                 {function}
Registry             ShouldProcess                 {HKLM, HKCU}
```

## <a name="see-also"></a><span data-ttu-id="a1d6a-156">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="a1d6a-156">See Also</span></span>

[<span data-ttu-id="a1d6a-157">Criando provedores do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1d6a-157">Creating Windows PowerShell Providers</span></span>](./how-to-create-a-windows-powershell-provider.md)

[<span data-ttu-id="a1d6a-158">Projetar seu provedor do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1d6a-158">Designing Your Windows PowerShell Provider</span></span>](./designing-your-windows-powershell-provider.md)
