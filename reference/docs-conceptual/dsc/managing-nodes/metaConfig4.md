---
ms.date: 12/12/2018
keywords: DSC,powershell,configuração,instalação
title: Configurando o LCM no PowerShell 4.0
description: O LCM (Gerenciador de Configurações Local) é executado em cada nó de destino e é responsável por analisar e aplicar as configurações que são enviadas para o nó.
ms.openlocfilehash: cf4d8cffdb6492f9f8cdde4cbb82ba5843427cee
ms.sourcegitcommit: 488a940c7c828820b36a6ba56c119f64614afc29
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/27/2020
ms.locfileid: "92646975"
---
# <a name="configuring-the-lcm-in-powershell-40"></a><span data-ttu-id="a9969-104">Configurando o LCM no PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="a9969-104">Configuring the LCM in PowerShell 4.0</span></span>

><span data-ttu-id="a9969-105">Aplica-se a: Windows PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="a9969-105">Applies To: Windows PowerShell 4.0</span></span>

<span data-ttu-id="a9969-106">**Para obter informações relacionadas ao Windows PowerShell 5.0 e versões posteriores, consulte [Configurando o Gerenciador de Configurações Local](metaConfig.md).**</span><span class="sxs-lookup"><span data-stu-id="a9969-106">**For information related to Windows PowerShell 5.0 and later, see [Configuring the Local Configuration Manager](metaConfig.md).**</span></span>

<span data-ttu-id="a9969-107">O Gerenciador de Configurações Local (LCM) é o mecanismo de Configuração de Estado Desejado (DSC) do Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a9969-107">Local Configuration Manager is the Windows PowerShell Desired State Configuration (DSC) engine.</span></span> <span data-ttu-id="a9969-108">É executado em todos os nós de destino e é responsável por chamar os recursos de configuração que estão incluídos em um script de configuração DSC.</span><span class="sxs-lookup"><span data-stu-id="a9969-108">It runs on all target nodes, and it is responsible for calling the configuration resources that are included in a DSC configuration script.</span></span> <span data-ttu-id="a9969-109">Este tópico lista as propriedades do Gerenciador de Configurações Local e descreve como você pode modificar as configurações do Gerenciador de Configurações Local em um nó de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-109">This topic lists the properties of Local Configuration Manager and describes how you can modify the Local Configuration Manager settings on a target node.</span></span>

## <a name="local-configuration-manager-properties"></a><span data-ttu-id="a9969-110">Propriedades do Gerenciador de Configurações Local</span><span class="sxs-lookup"><span data-stu-id="a9969-110">Local Configuration Manager properties</span></span>

<span data-ttu-id="a9969-111">O exemplo a seguir lista as propriedades do Gerenciador de Configurações Local que podem ser definidas ou recuperadas.</span><span class="sxs-lookup"><span data-stu-id="a9969-111">The following lists the Local Configuration Manager properties that you can set or retrieve.</span></span>

- <span data-ttu-id="a9969-112">**AllowModuleOverwrite** : controla se as novas configurações baixadas do serviço de configuração têm permissão para substituir as antigas no nó de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-112">**AllowModuleOverwrite** : Controls whether new configurations downloaded from the configuration service are allowed to overwrite the old ones on the target node.</span></span> <span data-ttu-id="a9969-113">Os valores possíveis são True e False.</span><span class="sxs-lookup"><span data-stu-id="a9969-113">Possible values are True and False.</span></span>
- <span data-ttu-id="a9969-114">**CertificateID** : a impressão digital de um certificado usado para proteger as credenciais passadas em uma configuração.</span><span class="sxs-lookup"><span data-stu-id="a9969-114">**CertificateID** : The thumbprint of a certificate used to secure credentials passed in a configuration.</span></span> <span data-ttu-id="a9969-115">Para obter mais informações, consulte [Quer proteger credenciais na Configuração de Estado Desejado do Windows PowerShell?](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/)</span><span class="sxs-lookup"><span data-stu-id="a9969-115">For more information see [Want to secure credentials in Windows PowerShell Desired State Configuration?](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span></span>
- <span data-ttu-id="a9969-116">**ConfigurationID** : indica um GUID que é usado para obter um arquivo de configuração específico de um serviço de pull.</span><span class="sxs-lookup"><span data-stu-id="a9969-116">**ConfigurationID** : Indicates a GUID which is used to get a particular configuration file from a pull service.</span></span> <span data-ttu-id="a9969-117">O GUID garante que o arquivo de configuração correto seja acessado.</span><span class="sxs-lookup"><span data-stu-id="a9969-117">The GUID ensures that the correct configuration file is accessed.</span></span>
- <span data-ttu-id="a9969-118">**ConfigurationMode** : especifica como o Gerenciador de Configurações Local realmente aplica a configuração aos nós de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-118">**ConfigurationMode** : Specifies how the Local Configuration Manager actually applies the configuration to the target nodes.</span></span> <span data-ttu-id="a9969-119">Ele pode usar os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="a9969-119">It can take the following values:</span></span>
  - <span data-ttu-id="a9969-120">**ApplyOnly** : com essa opção, a DSC aplicará a configuração e não fará nada além disso, a menos que uma nova configuração seja detectada quando você enviar uma nova configuração diretamente para o nó de destino, ou se você estiver se conectando a um serviço de pull e o DSC descobrir uma nova configuração quando verificar com o serviço de pull.</span><span class="sxs-lookup"><span data-stu-id="a9969-120">**ApplyOnly** : With this option, DSC applies the configuration and does nothing further unless a new configuration is detected, either by you sending a new configuration directly to the target node or if you are connecting to a pull service and DSC discovers a new configuration when it checks with the pull service.</span></span> <span data-ttu-id="a9969-121">Nenhuma ação será executada se a configuração de destino estiver dessincronizada.</span><span class="sxs-lookup"><span data-stu-id="a9969-121">If the target node's configuration drifts, no action is taken.</span></span>
  - <span data-ttu-id="a9969-122">**ApplyAndMonitor** : com essa opção (que é o padrão), a DSC aplica a todas as novas configurações, independentemente de terem sido enviadas por você diretamente para o nó de destino ou descobertas em um serviço de pull.</span><span class="sxs-lookup"><span data-stu-id="a9969-122">**ApplyAndMonitor** : With this option (which is the default), DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span>
    <span data-ttu-id="a9969-123">Por conseguinte, se a configuração do nó de destino estiver dessincronizada em relação ao arquivo de configuração, a DSC relatará a discrepância em logs.</span><span class="sxs-lookup"><span data-stu-id="a9969-123">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs.</span></span> <span data-ttu-id="a9969-124">Para obter mais informações sobre o registro em log de DSC, consulte [Usando Logs de Evento para Diagnosticar Erros na Configuração de Estado Desejado](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/).</span><span class="sxs-lookup"><span data-stu-id="a9969-124">For more about DSC logging, see [Using Event Logs to Diagnose Errors in Desired State Configuration](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/).</span></span>
  - <span data-ttu-id="a9969-125">**ApplyAndAutoCorrect** : com essa opção, a DSC aplica todas as novas configurações, independentemente de terem sido enviadas por você diretamente para o nó de destino ou descobertas em um serviço de pull.</span><span class="sxs-lookup"><span data-stu-id="a9969-125">**ApplyAndAutoCorrect** : With this option, DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="a9969-126">Depois disso, se a configuração do nó de destino estiver dessincronizada em relação ao arquivo de configuração, a DSC relatará a discrepância em logs e tentará ajustar a configuração do nó de destino para colocar em conformidade com o arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="a9969-126">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs, and then attempts to adjust the target node configuration to bring in compliance with the configuration file.</span></span>
- <span data-ttu-id="a9969-127">**ConfigurationModeFrequencyMins** : representa a frequência (em minutos) em que o aplicativo em segundo plano de DSC tenta implementar a configuração atual no nó de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-127">**ConfigurationModeFrequencyMins** : Represents the frequency (in minutes) at which the background application of DSC attempts to implement the current configuration on the target node.</span></span> <span data-ttu-id="a9969-128">O valor padrão é 15.</span><span class="sxs-lookup"><span data-stu-id="a9969-128">The default value is 15.</span></span> <span data-ttu-id="a9969-129">Esse valor pode ser definido em conjunto com RefreshMode.</span><span class="sxs-lookup"><span data-stu-id="a9969-129">This value can be set in conjunction with RefreshMode.</span></span> <span data-ttu-id="a9969-130">Quando RefreshMode é definido como PULL, o nó de destino entra em contato com o serviço de configuração em um intervalo definido por RefreshFrequencyMins e baixa a configuração atual.</span><span class="sxs-lookup"><span data-stu-id="a9969-130">When RefreshMode is set to PULL, the target node contacts the configuration service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="a9969-131">Independentemente do valor RefreshMode, no intervalo definido por ConfigurationModeFrequencyMins, o mecanismo de consistência aplica a configuração que foi baixada por último ao nó de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-131">Regardless of the RefreshMode value, at the interval set by ConfigurationModeFrequencyMins, the consistency engine applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="a9969-132">RefreshFrequencyMins deve ser definido como um número inteiro, múltiplo de ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="a9969-132">RefreshFrequencyMins should be set to an integer multiple of ConfigurationModeFrequencyMins.</span></span>
- <span data-ttu-id="a9969-133">**Credential** : indica credenciais (como é o caso de Get-Credential) necessárias para acessar recursos remotos, como entrar em contato com o serviço de configuração.</span><span class="sxs-lookup"><span data-stu-id="a9969-133">**Credential** : Indicates credentials (as with Get-Credential) required to access remote resources, such as to contact the configuration service.</span></span>
- <span data-ttu-id="a9969-134">**DownloadManagerCustomData** : representa uma matriz que contém dados personalizados específicos para o gerenciador de downloads.</span><span class="sxs-lookup"><span data-stu-id="a9969-134">**DownloadManagerCustomData** : Represents an array that contains custom data specific to the download manager.</span></span>
- <span data-ttu-id="a9969-135">**DownloadManagerName** : indica o nome da configuração e o gerenciador de downloads do módulo.</span><span class="sxs-lookup"><span data-stu-id="a9969-135">**DownloadManagerName** : Indicates the name of the configuration and module download manager.</span></span>
- <span data-ttu-id="a9969-136">**RebootNodeIfNeeded** : defina como `$true` para permitir que os recursos reinicializem o nó usando o sinalizador `$global:DSCMachineStatus`.</span><span class="sxs-lookup"><span data-stu-id="a9969-136">**RebootNodeIfNeeded** : Set this to `$true` to allow resources to reboot the Node using the `$global:DSCMachineStatus` flag.</span></span> <span data-ttu-id="a9969-137">Caso contrário, você precisará reinicializar manualmente o nó para qualquer configuração que exigir.</span><span class="sxs-lookup"><span data-stu-id="a9969-137">Otherwise, you will have to manually reboot the node for any configuration that requires it.</span></span> <span data-ttu-id="a9969-138">O valor padrão é `$false`.</span><span class="sxs-lookup"><span data-stu-id="a9969-138">The default value is `$false`.</span></span> <span data-ttu-id="a9969-139">Para usar essa configuração quando uma condição de reinicialização for representada por algo diferente do DSC (como o Windows Installer), combine essa configuração com o módulo [xPendingReboot](https://github.com/powershell/xpendingreboot).</span><span class="sxs-lookup"><span data-stu-id="a9969-139">To use this setting when a reboot condition is enacted by something other than DSC (such as Windows Installer), combine this setting with the [xPendingReboot](https://github.com/powershell/xpendingreboot) module.</span></span>
- <span data-ttu-id="a9969-140">**RefreshFrequencyMins** : usado ao configurar um serviço de pull.</span><span class="sxs-lookup"><span data-stu-id="a9969-140">**RefreshFrequencyMins** : Used when you have set up a pull service.</span></span> <span data-ttu-id="a9969-141">Representa a frequência (em minutos) em que o Gerenciador de Configurações Local contata um serviço de pull para baixar a configuração atual.</span><span class="sxs-lookup"><span data-stu-id="a9969-141">Represents the frequency (in minutes) at which the Local Configuration Manager contacts a pull service to download the current configuration.</span></span> <span data-ttu-id="a9969-142">Esse valor pode ser definido em conjunto com ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="a9969-142">This value can be set in conjunction with ConfigurationModeFrequencyMins.</span></span> <span data-ttu-id="a9969-143">Quando RefreshMode é definido como PULL, o nó de destino entra em contato com o serviço de pull em um intervalo definido por RefreshFrequencyMins e baixa a configuração atual.</span><span class="sxs-lookup"><span data-stu-id="a9969-143">When RefreshMode is set to PULL, the target node contacts the pull service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="a9969-144">No intervalo definido por ConfigurationModeFrequencyMins, o mecanismo de consistência aplica a configuração que foi baixada por último ao nó de destino.</span><span class="sxs-lookup"><span data-stu-id="a9969-144">At the interval set by ConfigurationModeFrequencyMins, the consistency engine then applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="a9969-145">Se RefreshFrequencyMins não for definido como um número inteiro, múltiplo de ConfigurationModeFrequencyMins, será arredondado pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="a9969-145">If RefreshFrequencyMins is not set to an integer multiple of ConfigurationModeFrequencyMins, the system will round it up.</span></span> <span data-ttu-id="a9969-146">O valor padrão é 30.</span><span class="sxs-lookup"><span data-stu-id="a9969-146">The default value is 30.</span></span>
- <span data-ttu-id="a9969-147">**RefreshMode** : os valores possíveis são **Push** (o padrão) e **Pull**.</span><span class="sxs-lookup"><span data-stu-id="a9969-147">**RefreshMode** : Possible values are **Push** (the default) and **Pull**.</span></span> <span data-ttu-id="a9969-148">Na configuração de "push", é necessário colocar um arquivo de configuração em cada nó de destino, usando qualquer computador cliente.</span><span class="sxs-lookup"><span data-stu-id="a9969-148">In the "push" configuration, you must place a configuration file on each target node, using any client computer.</span></span>
  <span data-ttu-id="a9969-149">No modo de "pull", configure um serviço de pull para o Gerenciador de Configurações Local contatar e acessar os arquivos de configuração.</span><span class="sxs-lookup"><span data-stu-id="a9969-149">In the "pull" mode, you must set up a pull service for Local Configuration Manager to contact and access the configuration files.</span></span>

> [!NOTE]
> <span data-ttu-id="a9969-150">O LCM inicia o ciclo **ConfigurationModeFrequencyMins** com base em:</span><span class="sxs-lookup"><span data-stu-id="a9969-150">The LCM starts the **ConfigurationModeFrequencyMins** cycle based on:</span></span>
>
> - <span data-ttu-id="a9969-151">Uma nova metaconfiguração aplicada usando `Set-DscLocalConfigurationManager`</span><span class="sxs-lookup"><span data-stu-id="a9969-151">A new metaconfig is applied using `Set-DscLocalConfigurationManager`</span></span>
> - <span data-ttu-id="a9969-152">Uma reinicialização do computador</span><span class="sxs-lookup"><span data-stu-id="a9969-152">A machine restart</span></span>
>
> <span data-ttu-id="a9969-153">Para qualquer condição em que o processo de temporizador apresentar uma falha, ela será detectada dentro de 30 segundos e o ciclo será reiniciado.</span><span class="sxs-lookup"><span data-stu-id="a9969-153">For any condition where the timer process experiences a crash, that will be detected within 30 seconds and the cycle will be restarted.</span></span> <span data-ttu-id="a9969-154">Uma operação simultânea pode atrasar o início do ciclo; se a duração dessa operação ultrapassar a frequência de ciclo configurada, o próximo temporizador não será iniciado.</span><span class="sxs-lookup"><span data-stu-id="a9969-154">A concurrent operation could delay the cycle from being started, if the duration of this operation exceeds the configured cycle frequency, the next timer will not start.</span></span>
>
> <span data-ttu-id="a9969-155">Por exemplo, a metaconfiguração é configurada com uma frequência de pull de 15 minutos e um pull ocorre em T1.</span><span class="sxs-lookup"><span data-stu-id="a9969-155">Example, the metaconfig is configured at a 15 minute pull frequency and a pull occurs at T1.</span></span> <span data-ttu-id="a9969-156">O Nó não conclui o trabalho por 16 minutos.</span><span class="sxs-lookup"><span data-stu-id="a9969-156">The Node does not finish work for 16 minutes.</span></span> <span data-ttu-id="a9969-157">O primeiro ciclo de 15 minutos será ignorado e próximo pull ocorrerá em T1 + 15 + 15.</span><span class="sxs-lookup"><span data-stu-id="a9969-157">The first 15 minute cycle is ignored, and next pull will happen at T1+15+15.</span></span>

### <a name="example-of-updating-local-configuration-manager-settings"></a><span data-ttu-id="a9969-158">Exemplo de atualização das configurações do Gerenciador de Configurações Local</span><span class="sxs-lookup"><span data-stu-id="a9969-158">Example of updating Local Configuration Manager settings</span></span>

<span data-ttu-id="a9969-159">Você pode atualizar as configurações do Gerenciador de Configurações Local de um nó de destino incluindo um bloco **LocalConfigurationManager** dentro do bloco de nó em um script de configuração, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="a9969-159">You can update the Local Configuration Manager settings of a target node by including a **LocalConfigurationManager** block inside the node block in a configuration script, as shown in the following example.</span></span>

```powershell
Configuration ExampleConfig
{
    Node "Server001"
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullService/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called
# Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"
```

<span data-ttu-id="a9969-160">A execução do script no exemplo anterior gera um arquivo MOF que especifica e armazena as configurações desejadas.</span><span class="sxs-lookup"><span data-stu-id="a9969-160">Running the script in the previous example generates a MOF file that specifies and stores the desired settings.</span></span> <span data-ttu-id="a9969-161">Para aplicar as configurações, pode-se usar o cmdlet **Set-DscLocalConfigurationManager** , conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="a9969-161">To apply the settings, you can use the **Set-DscLocalConfigurationManager** cmdlet, as shown in the following example.</span></span>

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> [!NOTE]
> <span data-ttu-id="a9969-162">Para o parâmetro **Path** , você deve especificar o mesmo caminho que especificou para o parâmetro **OutputPath** quando invocou a configuração no exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="a9969-162">For the **Path** parameter, you must specify the same path that you specified for the **OutputPath** parameter when you invoked the configuration in the previous example.</span></span>

<span data-ttu-id="a9969-163">Para ver as configurações do Gerenciador de Configurações Local atual, você pode usar o cmdlet **Get-DscLocalConfigurationManager**.</span><span class="sxs-lookup"><span data-stu-id="a9969-163">To see the current Local Configuration Manager settings, you can use the **Get-DscLocalConfigurationManager** cmdlet.</span></span> <span data-ttu-id="a9969-164">Se você invocar esse cmdlet sem parâmetros, ele receberá, por padrão, as configurações do Gerenciador de Configurações Local para o nó no qual será executado.</span><span class="sxs-lookup"><span data-stu-id="a9969-164">If you invoke this cmdlet with no parameters, by default it will get the Local Configuration Manager settings for the node on which you run it.</span></span> <span data-ttu-id="a9969-165">Para especificar outro nó, use o parâmetro **CimSession** com esse cmdlet.</span><span class="sxs-lookup"><span data-stu-id="a9969-165">To specify another node, use the **CimSession** parameter with this cmdlet.</span></span>
